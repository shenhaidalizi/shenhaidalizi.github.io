---
layout:     post
title:      [树莓派移植Tips]
subtitle:   [复试之前抱佛脚]
date:       [2023-03-16]
author:     Siyuan Zhou
header-img: img/post-bg-article.jpg
catalog: true
tags:
    - Operation System

---

# 关于硬件

有趣的是，CPU不是板上的主处理器。当他通电时，第一个GPU将运行。当它通过执行`bootcode.bin`中的代码完成初始化，它将加载并执行`start.elf`可执行文件。这不是ARM可执行文件，而是为GPU编译的。我们感兴趣的时`start.elf`寻找不同的ARM可执行文件，全部以之开始和结尾。当我们要在`AArch64`模式下对CPU进行编程时，我们只需要对CPU编程。加载后，GPU会出发ARM处理器上的重置线，它开始在地址`0x80000`（更准确地说是0，但GPU会先将ARM初始化和跳转代码放在那里）处执行代码。

RAM由CPU和GPU共享，这意味着一个可以读取另一个写入内存的内容。为了避免混淆，建立了定义明确的通信接口。CPU将通信消息写入邮箱，并通知GPU读取它。GPU对其进行解释，并将响应信息放置在同一地址。CPU必须轮询内存才知道GPU何时完成，然后才能读取响应。

与之相似的，所有外围I/O设备都在内存中与CPU通信。每个都有从`0x3f0000000`开始的专用内存地址，但它不在真正的RAM中（称之为内存映射I/O）。没有外围设备的邮箱，它们都有自己的协议通信，它们的内存必须以4字节对齐的地址以32位单元读取和写入，并且每个都有控制/状态和数据字。

CPU中还有一个内存管理单元，它允许创建虚拟地址空间。这可以通过特定的CPU寄存器进行变成，它将这些MMIO地址映射到虚拟地址空间。
